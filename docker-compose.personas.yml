# Auto-generated docker-compose configuration for concurrent persona scraping
# Generated by: scripts/generate-docker-compose-personas.js
# To regenerate: node scripts/generate-docker-compose-personas.js
#
# Usage:
#   - Run all personas concurrently: docker compose -f docker-compose.personas.yml up
#   - Run specific persona: docker compose -f docker-compose.personas.yml up scraper-persona-<persona_id>
#   - Run in background: docker compose -f docker-compose.personas.yml up -d
#   - Run interactively (for verification prompts): docker compose -f docker-compose.personas.yml run --rm -it scraper-persona-<persona_id>
#
# Environment Variables:
#   - USE_PROXY=false to disable proxy (adds --no-proxy flag)
#   - BLOCK_MEDIA=image,media to customize media blocking (adds --block-media flag)
#   - VERIFICATION_CODE=123456 to provide verification code (for Docker non-interactive mode)
#   Examples:
#     docker compose -f docker-compose.personas.yml up -e USE_PROXY=false
#     docker compose -f docker-compose.personas.yml up -e BLOCK_MEDIA=none
#     VERIFICATION_CODE=123456 docker compose -f docker-compose.personas.yml up

services:
  scraper-persona-persona-br-right-male-001:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    platform: linux/amd64
    container_name: instagram-scraper-persona-br-right-male-001
    restart: unless-stopped
    stdin_open: true  # Enable stdin for interactive prompts
    tty: true         # Allocate a pseudo-TTY for interactive prompts
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PERSONA_ID=PERSONA_BR_RIGHT_MALE_001
      - VERIFICATION_CODE=${VERIFICATION_CODE:-}  # Optional: set verification code via env var
      # Optional: Set USE_PROXY=false to disable proxy (adds --no-proxy flag)
      # - USE_PROXY=false
      # Optional: Set BLOCK_MEDIA to customize media blocking (adds --block-media flag)
      # Examples: BLOCK_MEDIA=image,media  or  BLOCK_MEDIA=none  or  BLOCK_MEDIA=all
      # - BLOCK_MEDIA=image,media
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./personas:/app/personas:ro
    # Supports environment variables USE_PROXY, BLOCK_MEDIA, and VERIFICATION_CODE
    # Default USE_PROXY value comes from src/config/defaults.js (proxy.enabled)
    command: >
      sh -c "
            CMD='node src/main.js --persona PERSONA_BR_RIGHT_MALE_001 --headless';
      if [ \"$${USE_PROXY:-false}\" = 'false' ]; then CMD=\"$$CMD --no-proxy\"; fi;
      if [ -n \"$${BLOCK_MEDIA}\" ]; then CMD=\"$$CMD --block-media \\\"$${BLOCK_MEDIA}\\\"\"; fi;
      exec $$CMD
      "
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M

  scraper-persona-persona-de-left-female-002:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    platform: linux/amd64
    container_name: instagram-scraper-persona-de-left-female-002
    restart: unless-stopped
    stdin_open: true  # Enable stdin for interactive prompts
    tty: true         # Allocate a pseudo-TTY for interactive prompts
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PERSONA_ID=PERSONA_DE_LEFT_FEMALE_002
      - VERIFICATION_CODE=${VERIFICATION_CODE:-}  # Optional: set verification code via env var
      # Optional: Set USE_PROXY=false to disable proxy (adds --no-proxy flag)
      # - USE_PROXY=false
      # Optional: Set BLOCK_MEDIA to customize media blocking (adds --block-media flag)
      # Examples: BLOCK_MEDIA=image,media  or  BLOCK_MEDIA=none  or  BLOCK_MEDIA=all
      # - BLOCK_MEDIA=image,media
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./personas:/app/personas:ro
    # Supports environment variables USE_PROXY, BLOCK_MEDIA, and VERIFICATION_CODE
    # Default USE_PROXY value comes from src/config/defaults.js (proxy.enabled)
    command: >
      sh -c "
            CMD='node src/main.js --persona PERSONA_DE_LEFT_FEMALE_002 --headless';
      if [ \"$${USE_PROXY:-false}\" = 'false' ]; then CMD=\"$$CMD --no-proxy\"; fi;
      if [ -n \"$${BLOCK_MEDIA}\" ]; then CMD=\"$$CMD --block-media \\\"$${BLOCK_MEDIA}\\\"\"; fi;
      exec $$CMD
      "
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M

  scraper-persona-persona-de-right-male-001:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    platform: linux/amd64
    container_name: instagram-scraper-persona-de-right-male-001
    restart: unless-stopped
    stdin_open: true  # Enable stdin for interactive prompts
    tty: true         # Allocate a pseudo-TTY for interactive prompts
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PERSONA_ID=PERSONA_DE_RIGHT_MALE_001
      - VERIFICATION_CODE=${VERIFICATION_CODE:-}  # Optional: set verification code via env var
      # Optional: Set USE_PROXY=false to disable proxy (adds --no-proxy flag)
      # - USE_PROXY=false
      # Optional: Set BLOCK_MEDIA to customize media blocking (adds --block-media flag)
      # Examples: BLOCK_MEDIA=image,media  or  BLOCK_MEDIA=none  or  BLOCK_MEDIA=all
      # - BLOCK_MEDIA=image,media
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./personas:/app/personas:ro
    # Supports environment variables USE_PROXY, BLOCK_MEDIA, and VERIFICATION_CODE
    # Default USE_PROXY value comes from src/config/defaults.js (proxy.enabled)
    command: >
      sh -c "
            CMD='node src/main.js --persona PERSONA_DE_RIGHT_MALE_001 --headless';
      if [ \"$${USE_PROXY:-false}\" = 'false' ]; then CMD=\"$$CMD --no-proxy\"; fi;
      if [ -n \"$${BLOCK_MEDIA}\" ]; then CMD=\"$$CMD --block-media \\\"$${BLOCK_MEDIA}\\\"\"; fi;
      exec $$CMD
      "
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M

  scraper-persona-persona-us-left-male-001:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    platform: linux/amd64
    container_name: instagram-scraper-persona-us-left-male-001
    restart: unless-stopped
    stdin_open: true  # Enable stdin for interactive prompts
    tty: true         # Allocate a pseudo-TTY for interactive prompts
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PERSONA_ID=PERSONA_US_LEFT_MALE_001
      - VERIFICATION_CODE=${VERIFICATION_CODE:-}  # Optional: set verification code via env var
      # Optional: Set USE_PROXY=false to disable proxy (adds --no-proxy flag)
      # - USE_PROXY=false
      # Optional: Set BLOCK_MEDIA to customize media blocking (adds --block-media flag)
      # Examples: BLOCK_MEDIA=image,media  or  BLOCK_MEDIA=none  or  BLOCK_MEDIA=all
      # - BLOCK_MEDIA=image,media
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./personas:/app/personas:ro
    # Supports environment variables USE_PROXY, BLOCK_MEDIA, and VERIFICATION_CODE
    # Default USE_PROXY value comes from src/config/defaults.js (proxy.enabled)
    command: >
      sh -c "
            CMD='node src/main.js --persona PERSONA_US_LEFT_MALE_001 --headless';
      if [ \"$${USE_PROXY:-false}\" = 'false' ]; then CMD=\"$$CMD --no-proxy\"; fi;
      if [ -n \"$${BLOCK_MEDIA}\" ]; then CMD=\"$$CMD --block-media \\\"$${BLOCK_MEDIA}\\\"\"; fi;
      exec $$CMD
      "
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M

  scraper-persona-persona-us-right-male-001:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    platform: linux/amd64
    container_name: instagram-scraper-persona-us-right-male-001
    restart: unless-stopped
    stdin_open: true  # Enable stdin for interactive prompts
    tty: true         # Allocate a pseudo-TTY for interactive prompts
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PERSONA_ID=PERSONA_US_RIGHT_MALE_001
      - VERIFICATION_CODE=${VERIFICATION_CODE:-}  # Optional: set verification code via env var
      # Optional: Set USE_PROXY=false to disable proxy (adds --no-proxy flag)
      # - USE_PROXY=false
      # Optional: Set BLOCK_MEDIA to customize media blocking (adds --block-media flag)
      # Examples: BLOCK_MEDIA=image,media  or  BLOCK_MEDIA=none  or  BLOCK_MEDIA=all
      # - BLOCK_MEDIA=image,media
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./personas:/app/personas:ro
    # Supports environment variables USE_PROXY, BLOCK_MEDIA, and VERIFICATION_CODE
    # Default USE_PROXY value comes from src/config/defaults.js (proxy.enabled)
    command: >
      sh -c "
            CMD='node src/main.js --persona PERSONA_US_RIGHT_MALE_001 --headless';
      if [ \"$${USE_PROXY:-false}\" = 'false' ]; then CMD=\"$$CMD --no-proxy\"; fi;
      if [ -n \"$${BLOCK_MEDIA}\" ]; then CMD=\"$$CMD --block-media \\\"$${BLOCK_MEDIA}\\\"\"; fi;
      exec $$CMD
      "
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M
